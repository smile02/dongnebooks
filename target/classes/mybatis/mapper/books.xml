<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="books">
	<select id="booksList" resultMap="booksMap" parameterType="map">
		 select * 
	    from (select rownum as rnum, a.* from 
	    	(
	    		select * from 
	    			books
	    			<if test="tag != null and tag != 'all'">
	    			where
	    				<choose>
	    					<when test="tag == 'IT'">
	    						b_category = #{tag}		
	    					</when>
	    					<when test="tag == '사회'">
	    						b_category = #{tag}
	    					</when>
	    					<when test="tag = '과학'">
	    						b_category = #{tag}
	    					</when>
	    					<when test="tag == '문학'">
	    						b_category = #{tag}
	    					</when>
	    				</choose>	    				
	    			</if>	    			
	    			order by regdate desc	    		
	    		) a
	    	) 
	    where rnum between #{start} and #{end}
	</select>
	
	<resultMap type="books" id="booksMap">
		
	</resultMap>
	
	<insert id="booksAdd" parameterType="books">
		insert into books
			values(seq_books_idx.nextval,
				   #{title},
				   'test',
				   #{comments},
				   sysdate,
				   #{price},
				   #{status},
				   #{fee},
				   #{photo},
				   #{d_type},
				   #{author},
				   #{b_category},
				   #{s_category},
				   '판매 중')
	</insert>
	
	<select id="booksView" parameterType="int" resultType="books">
		select * from books
			where idx = #{value}
	</select>
	
	<update id="booksMod" parameterType="books">
		update books set price = #{price},
						 status = #{status},
						 d_type = #{d_type},
						 fee = #{fee},
						 author = #{author},
						 b_category = #{b_category},
						 s_category = #{s_category},
						 deal = #{deal},
						 comments = #{comments}
			where idx = #{idx}
	</update>
	
	<select id="getTotalCount" resultType="int" parameterType="map">
		select count(*) from board			
	</select>
	
</mapper>